function result = simulate_im_over_regular_graph(uff, ufn, unn, graph, alpha, iterate_time, N)
    function fit_result = fitness_calculate(index,k)
        fit = (1-alpha);     %fit=(1-alpha)+alpha*U
        if action_table(index)==1       %è‹¥è¾“å…¥ä¸ºforward    
           % while con_matrix(index, l) ~= 0        %å¾ªç¯kæ¬?
           for l=1:k
                if action_table(con_matrix(index,l))==1              %ç¬¬lä¸ªé‚»å±…ä¸ºforward
                    fit = fit + alpha*uff;         %è‡ªå·±çš„fitnessåŠ ä¸Šalpha*uff
                else                               %ç¬¬lä¸ªé‚»å±…ä¸ºnot forward
                    fit = fit + alpha*ufn;         %è‡ªå·±çš„fitnessåŠ ä¸Šalpha*ufn     
                end 
            end
        else                          %è‹¥è¾“å…¥ä¸ºnot forward
            %while con_matrix(index, l) ~= 0    %å¾ªç¯kæ¬? 
            for l=1:k
                if action_table(con_matrix(index,l))==1          %ç¬¬lä¸ªé‚»å±…ä¸ºforward
                    fit = fit + alpha*ufn;
                else                           %ç¬¬lä¸ªé‚»å±…ä¸ºnot forward
                    fit = fit + alpha*unn;
                end
            %    l = l + 1;
            end
        end
        fit_result = fit;
    end
    
    global con_matrix
    con_matrix = graph;  %ç¬¬iè¡Œè¡¨ç¤ºç¬¬iä¸ªç‚¹çš„é‚»å±…æ ‡å?
%     con_matrix = regular_graph_generate(N,k);
    action_table = zeros(1,N);  %å®šä¹‰å‡ºé•¿åº¦ä¸ºNçš?0çŸ©é˜µï¼?1*Nï¼?
%     for i = 1:N
%         action_table(i) = randi(2)-1;
%     end
    NN=0.1*N;
    NN=floor(NN);
    starter_table = randperm(N,NN);   %1000ä¸­éšæœºæŠ½å–äº†100ä¸ªæ•°
    for i = starter_table
        action_table(i) = 1;        %action_tableä¸­éšæœºå®šä¹‰å‡º100ä¸ªä¸º1çš„ç‚¹ï¼Œå…¶ä½?900ä¸?0ï¼?%%%action_table=1è¡¨ç¤ºforwardï¼?0è¡¨not forward
    end
    x = zeros(1,iterate_time);      %xä¸ºé•¿åº¦ä¸º1*400
    count = 1;
    x(count) = sum(action_table)/N;
    count = count + 1;
    K=zeros(1,N);
    for qqq=1:N
        for ppp=1:1045
            if graph(qqq,ppp)~=0
                K(qqq)=K(qqq)+1;
            end
        end
    end
    while cou`nt<=iterate_time
        %æ¯æ¬¡éå†å…¨éƒ¨ç‚¹ï¼Œå¹¶æ ¹æ®IMâ€”â?”ruleæ›´æ–°
         for p = 1:N
            i = randi(N);    %%éšæœºä»?1000ä¸ªäººä¸­é?‰ä¸€ä¸ªi
            friend_list=[];
            for q=1:K(i)
                    friend_list=[friend_list,graph(i,q)];
            end
          %  friend_list = graph(i,:);    %å¯»æ‰¾içš„é‚»å±…ï¼Œè¿”å›ä¸?ä¸?1*Nçš„çŸ©é˜µï¼Œå‰kä¸ªæœ‰æ•°ï¼Œåé¢ä¸?0
            friend_number = length(friend_list);   %k
            %calculate self-fitness
            fit_self = fitness_calculate(i,K(i));    %ç®—å‡ºè‡ªå·±çš„fitness
            fit_f = 0; 
            fit_n = 0;
            if action_table(i)==1          %å¦‚æœiè‡ªå·±forward
                for j =1:friend_number     %jä»?1åˆ°k    
                    if action_table(friend_list(j))==1              %å¦‚æœiçš„é‚»å±…jï¼Œä¸ºforward
                        fit_f = fit_f + fitness_calculate(friend_list(j),K(friend_list(j)));
                    else                                            %å¦‚æœiçš„é‚»å±…jï¼Œä¸ºnot forward
                        fit_n = fit_n + fitness_calculate(friend_list(j),K(friend_list(j)));           
                    end
                end
                judge = fit_n/(fit_f + fit_n + fit_self);
                rand_num = rand;              %rand_numä¸º[0,1]é—´çš„æ•?
                if rand_num <= judge
                    action_table(i) = 0;      %å°†è‡ªå·±å˜ä¸ºnot forward
                end
            else                       %å¦‚æœiä¸ºnot forward
                for j =1:friend_number
                    if action_table(friend_list(j))==1
                        fit_f = fit_f + fitness_calculate(friend_list(j),K(friend_list(j)));
                    else
                        fit_n = fit_n + fitness_calculate(friend_list(j),K(friend_list(j)));
                    end
                end
                judge = fit_f/(fit_f + fit_n + fit_self);
                rand_num = rand;
                if rand_num <= judge
                    action_table(i) = 1;
                end
            end            
         end        
        x(count) = sum(action_table)/N;
        count = count + 1;
    end
    result = x;
end